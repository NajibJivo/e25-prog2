# Day 1: Build `Work` entity and a REST API
## Objectives

- Create a `Work` entity with fields for title, work type, details, authors, and subjects.

- Implement a REST API to manage `Work` entities.

- Use Spring Data JPA to interact with the database.

## Good practice
- Create a GitHub repository for your project and commit your changes regularly.

- Use branching to manage your work. For example, create a branch called `day1` for this exercise.

- Write clear commit messages that describe the changes you made.

- Use meaningful names for your classes, methods, and variables.

- It is a good idea to test that your application works as expected after each step.

## Steps
### 1. **Create a Spring Boot project**:
- Create a new Spring Boot project called `library`, with the following dependencies:
  - Spring Web
  - Spring Data JPA
  - H2 Database (for in-memory database)
  - MySQL Driver

- Add this to your `application.properties` file:
    ```properties
    # H2 Configuration
    spring.datasource.url=jdbc:h2:mem:testdb
    spring.datasource.driver-class-name=org.h2.Driver
    spring.datasource.username=sa
    spring.datasource.password=
    spring.h2.console.enabled=true
    spring.h2.console.path=/h2-console
    spring.jpa.hibernate.ddl-auto=create-drop

    ## Logging
    spring.jpa.show-sql=true
    logging.level.org.hibernate.SQL=DEBUG
    logging.level.sql=DEBUG

    # MySQL Configuration
    #spring.datasource.url=jdbc:mysql://localhost:3306/librarydb?createDatabaseIfNotExist=true
    #spring.datasource.username=root
    #spring.datasource.password=SECRET
    ```

- **Note** that we can use `createDatabaseIfNotExist=true` to create the database if it does not exist. This is useful for development purposes.

---

### 2. **Create the package structure**:
**Create the following package structure:**
```
  library/
  ├── pom.xml
  └── src
      └── main
          ├── java/ek/osnb/library
          │   ├── LibraryApplication.java
          │   ├── common
          │   │   └── InitData.java
          │   └── catalog
          │       ├── controller
          │       │   └── WorkController.java
          │       ├── model
          │       │   ├── Work.java
          │       │   └── WorkType.java
          │       ├── repository
          │       │   └── WorkRepository.java
          │       └── service
          │           └── WorkService.java
          └── resources
              └── application.properties
```
### 3. **Create the `WorkType` enum**:

Define the enum values for `BOOK`, `ARTICLE`, add more as needed:

---
### 2. **Create the `Work` entity**:
- Create a `Work` class in the `model` package with the following fields:
  - `id`: Long (Primary Key)
  - `title`: String
  - `workType`: WorkType (Enum) - use `@Enumerated(EnumType.STRING)` to store the enum as a string in the database.
  - `details`: String
  - `authors`: String
  - `subjects`: String

- Annotate the class with `@Entity` and use `@GeneratedValue(strategy = GenerationType.IDENTITY)` for the `id` field.

- Add getters and setters for all fields.

- **NOTE** We will later add relationships to other entities like `Author`, `Subject`, etc., but for now, we will keep it simple.

---

### 3. **Create the `WorkRepository` interface**:
- Extend `JpaRepository<Work, Long>` to provide CRUD operations for `Work` entities.

- Add a query method to search for works by title, e.g. `List<Work> findByTitleContaining(String title)`.

---

### 4. **Create the `WorkService` class**:
- Create a service class to handle business logic for `Work` entities.

- Use constructor injection to inject the `WorkRepository`.

- It should have methods for:

  - `createWork(Work work)`: Save a new `Work` entity.

  - `getAllWorks()`: Retrieve all `Work` entities.

  - `getWorkById(Long id)`: Retrieve a `Work` entity by its ID.

  - `updateWork(Long id, Work work)`: Update an existing `Work` entity.

  - `deleteWork(Long id)`: Delete a `Work` entity by its ID.

  - `searchWorks(String title)`: Search for `Work` entities by title.

---

### 5. **Implement the REST API - `WorkController`**:
- Create a Rest controller class `WorkController` in the `controller` package.

- Annotate the class with `@RestController` and `@RequestMapping("/api/works")`.

- Use constructor injection to inject the `WorkService`.

- Implement the following endpoints:

  - `GET /api/works`: Retrieve all works.

  - `GET /api/works/{id}`: Retrieve a work by ID.

  - `POST /api/works`: Create a new work.

  - `PUT /api/works/{id}`: Update an existing work.

  - `DELETE /api/works/{id}`: Delete a work by ID.

  - `GET /api/works/search?title={title}`: Search for works by title.

---
     
### 6. **Create the `InitData` class for sample data**:
- Implement the `CommandLineRunner` interface in the `InitData` class.
- Use the `WorkRepository` to save at least 3 sample `Work` entities inside the `run` method.
- Annotate the class with `@Component` so that it runs on application startup.

---

### 7. **Test the API using Postman**:
- Use Postman to test the API endpoints you created.
#### Example: `POST`/`PUT` requests:
  - URL: `http://localhost:8080/api/works`
  - Method: `POST` or `PUT`
  - Request body (JSON):

    ```json
    {
        "title": "Clean Code",
        "workType": "BOOK",
        "details": "A handbook of agile software craftsmanship",
        "authors": "Robert C. Martin",
        "subjects": "Programming, Software Engineering"
    }
    ```
#### Example: `GET` requests:
- URL: `http://localhost:8080/api/works`

- Response (`200 OK`):

  ```json
  [
      {
          "id": 1,
          "title": "Building Java Programs",
          "workType": "BOOK",
          "details": "An introductory guide to Java programming.",
          "authors": "Stuart Reges, Marty Stepp",
          "subjects": "Programming, Java"
      },
      {
          "id": 2,
          "title": "Effective Java",
          "workType": "BOOK",
          "details": "A guide to best practices in Java programming.",
          "authors": "Joshua Bloch",
          "subjects": "Programming, Java"
      }
  ]
  ```