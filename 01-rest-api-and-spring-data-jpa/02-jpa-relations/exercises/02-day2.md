# Day 2: Add `Edition` and `Publisher` entities
## Objectives

- Create an `Edition` entity with fields for edition number, year, and format (e.g., hardcover, paperback, ebook).

- Create a `Publisher` entity with fields for name, address, and contact information.

- Establish relationships between `Work`, `Edition`, and `Publisher` entities.

- Update the REST API to manage `Edition` and `Publisher` entities.

## Good practice
- Create a GitHub repository for your project and commit your changes regularly.

- Use branching to manage your work. For example, create a branch called `day2` for this exercise.

- Write clear commit messages that describe the changes you made.

- Use meaningful names for your classes, methods, and variables.

- It is a good idea to test that your application works as expected after each step.

## Steps
### 1. **Create the `Edition` entity**:
- Create an `Edition` class in the `model` package with the following fields:
  - `id`: Long (Primary Key)
  - `editionNumber`: String
  - `year`: Integer
  - `format`: String

- Annotate the class with `@Entity` and use `@GeneratedValue(strategy = GenerationType.IDENTITY)` for the `id` field.

- Add getters and setters for all fields.

### 2. **Create the `Publisher` entity**:
- Create a `Publisher` class in the `model` package with the following fields:
  - `id`: Long (Primary Key)
  - `name`: String
  - `address`: String
  - `contactInfo`: String

- Annotate the class with `@Entity` and use `@GeneratedValue(strategy = GenerationType.IDENTITY)` for the `id` field.

- Add getters and setters for all fields.

---

### 3. **Establish relationships between `Edition` and `Publisher`**:
- Update the `Edition` class to include a ManyToOne relationship with `Publisher`.

- Make it unidirectional, meaning `Edition` will have a reference to `Publisher`, but not the other way around.

---

### 4. **Establish relationships**:
- Update the `Work` class to include a OneToMany relationship with `Edition`:

- Annotate the fields with `@OneToMany` and `@ManyToOne` as needed.


### 5. **Create repositories**:
- Create a JPA repository interface for `Edition`:

- Create a JPA repository interface for `Publisher`:


### 6. **Create DTOs**:
- Create DTO classes for `WorkDto`, `EditionDto`, and `PublisherDto` - use `records` for simplicity.
```java
public record WorkDto(Long id, String title, String workType, String details, String author, List<EditionDto> editions, String subjects) {}
public record EditionDto(Long id, String editionNumber, int year, String format, PublisherDto publisher) {}
public record PublisherDto(Long id, String name, String address, String contactInfo) {}
```

- Ensure that the DTOs contain only the necessary fields for the API responses.

- Create a mapper class to convert between entities and DTOs.

  - There should be a method to convert `Work` to `WorkDto`, `Edition` to `EditionDto`, and `Publisher` to `PublisherDto`, and the other way around.

### 7. **Update the service layer**:
The service layer should only return and receive DTOs, not entities.

**Example:**
```java
@Service
public class WorkService {
    // Repositories

    private final Mapper mapper;

    // Constructor injection

    public WorkDto getWorksById(Long id) {
        Optinal<Work> workOpt = workRepository.findById(id);
        if (workOpt.isPresent()) {
            return mapper.toDto(workOpt.get());
        } 
        throw new RuntimeException("Work not found with id: " + id);
    }

    // Other service methods for CRUD operations
}
```

### 8. **Update the controller**:
Update the controller to use DTOs for all request and response bodies.

**Example:**
```java
@RestController
@RequestMapping("/api/works")
public class WorkController {


    @GetMapping("/{id}")
    public WorkDto getWorkById(@PathVariable Long id) {
      try {
          return workService.getWorksById(id);
      } catch (RuntimeException e) {
          return ResponseEntity.status(HttpStatus.NOT_FOUND).body(null);
      }
    }

    // Other controller methods
}
```

### 9. **Update the `InitData` class**:
- Modify the `InitData` class to include sample data for `Edition` and `Publisher` entities.

- Use the `EditionRepository` and `PublisherRepository` to save `Edition` and `Publisher` entities.

### 10. **Test the API using Postman**:
- Use Postman to test the API endpoints you created.

- Example: `GET /api/works`:

CREATE RESPNSE based on
public record WorkDto(Long id, String title, String workType, String details, String author, List<EditionDto> editions, String subjects) {}
public record EditionDto(Long id, String editionNumber, int year, String format, PublisherDto publisher) {}
public record PublisherDto(Long id, String name, String address, String contactInfo) {}
```json
[
    {
        "id": 1,
        "title": "Effective Java",
        "workType": "Book",
        "details": "A comprehensive guide to best practices in Java programming.",
        "author": "Joshua Bloch",
        "editions": [
            {
                "id": 1,
                "editionNumber": "3rd Edition",
                "year": 2018,
                "format": "Hardcover",
                "publisher": {
                    "id": 1,
                    "name": "Addison-Wesley",
                    "address": "Boston, MA",
                    "contactInfo": "info@addison-wesley.com"
                }
            }
        ],
        "subjects": "Java, Programming"
    },
    {
        "id": 2,
        "title": "Clean Code",
        "workType": "Book",
        "details": "A handbook of agile software craftsmanship.",
        "author": "Robert C. Martin",
        "editions": [
            {
                "id": 2,
                "editionNumber": "1st Edition",
                "year": 2008,
                "format": "Paperback",
                "publisher": {
                    "id": 2,
                    "name": "Prentice Hall",
                    "address": "Upper Saddle River, NJ",
                    "contactInfo": "info@prenticehall.com"
                }
            }
        ],
        "subjects": "Software Engineering, Programming"
    }
]